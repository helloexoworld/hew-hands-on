<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>Create a WarpScript extension - Warp10 Documentation</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon"/>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>

  <style>
    body {
      background-color: #eeeeee;
    }
  </style>


  <link rel="stylesheet" href="/assets/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/font-awesome.min.css">
  <link rel="stylesheet" href="/assets/https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />

  <script src="/assets/webcomponents-lite.js"></script>
  <script src="/assets/jquery.js"></script>
  <script src="/assets/bootstrap.js"></script>

  <link rel="import" href="/assets/warp10-components.html">

  <!--
  <script src="http://localhost:8000/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="http://localhost:8000/bower_components/jquery/dist/jquery.js"></script>
  <script src="http://localhost:8000/bower_components/bootstrap/dist/js/bootstrap.js"></script>
  <link   rel="import" href="http://localhost:8000/bower_components/polymer/polymer.html">
  <link   rel="import" href="http://localhost:8000/bower_components/warp10-navbar/warp10-navbar.html">
  <link   rel="import" href="http://localhost:8000/bower_components/warp10-quantum/warp10-conf.html">
  <link   rel="import" href="http://localhost:8000/bower_components/warp10-quantum/warp10-quantum-widget.html">
  -->

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/docs/css/warp10.css">
  <link rel="stylesheet" href="/docs/css/warp10-navbar.css">
  <!-- Pygments Github CSS -->
  <link rel="stylesheet" href="/docs/css/syntax.css">

  <style>
    :host {
      display: block;
    }
    .top-10 { margin-top:10px; }
    h4 {
      font-weight: bold;
    }
    .list-group-item {
      cursor: pointer;
    }
  </style>
</head>

<body>
  
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <!--
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    -->
      <a class="navbar-brand" href="/docs">
        <div class="navbar-id">
          <div class="navbar-id-icon">
            <span id="icon-CityzenData" class="icon-CityzenData"></span>
          </div>
          <div class="navbar-id-name">
            Warp 10
          </div>
        </div>
      </a>
    </div>
    <div class="collapse navbar-nav navbar-collapse navbar-right">
      <div class="form-inline">
        <div class="input-group">
          <div class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></div>
          <input id="search_box" class="form-control" style="vertical-align: middle" >
        </div>
      </div>
    </div>
  </div>
</nav>
<div class="navbar-separator" > </div>

<warp10-conf conf="doc"></warp10-conf>

<div id="mainbody">

  <div class="container top-10" id="main-container">
    <div class="row">
      <button type="button" class="navbar-toggle toggle collapsed" data-toggle="collapse" data-target="#sidebar" aria-expanded="false">
  <span class="sr-only">Toggle navigation</span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
</button>
<div id="sidebar" class="col-sm-3 collapse">

  <div class="panel-group" id="side-menu">

    <div id="panel-home" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-home">
        <span class="glyphicon glyphicon-home"></span>Home</a>
    </h4>
  </div>
  <div id="collapse-home" class="panel-collapse collapse ">
    <div class="list-group">

      <a class="list-group-item" href="/docs/introduction/platform">Overview</a>

      <a class="list-group-item" href="/docs/introduction/concepts">Concepts</a>

      <a class="list-group-item" href="/docs/introduction/history">History</a>

      <a class="list-group-item" href="/docs/introduction/team">Team</a>

      <a class="list-group-item" href="/docs/introduction/versions">Versions</a>

    </div>

  </div>
</div>


    <div id="panel-howto" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-howto">
        <span class="glyphicon glyphicon-education"></span>How-to
      </a>
    </h4>
  </div>
  <div id="collapse-howto" class="panel-collapse collapse  in ">
    <div class="list-group">

      <a class="list-group-item" href="/docs/getting-started">Getting started</a>

      <a class="list-group-item" href="/docs/howto/data-modeling">Data modeling</a>

      <a class="list-group-item" href="/docs/howto/migrate-from">Migrate from</a>
      <div class="list-group-item">Tutorials</div>
      <div class="list-group">
        <a class="list-group-item" href="/docs/howto/intro-bucketize">BUCKETIZE</a>
        <a class="list-group-item" href="/docs/howto/intro-reduce">REDUCE</a>
      </div>

      <a class="list-group-item" href="/docs/howto/pushing-data">Pushing data</a>
      <div class="list-group">
        <a class="list-group-item" href="/docs/howto/websocket-push">Using WebSockets</a>
        <a class="list-group-item" href="/docs/howto/collecting-tools">Using metrics collecting tools</a>
      </div>

      <a class="list-group-item" href="/docs/howto/accessing-data">Accessing data</a>

      <a class="list-group-item" href="/docs/howto/fetching-data">Fetching data</a>

      <a class="list-group-item" href="/docs/howto/create-a-udf">Create and deploy one User Defined Function</a>
      
      <a class="list-group-item" href="/docs/howto/create-a-warpscript-extension">Create a WarpScript extension</a>

      <a class="list-group-item" href="/docs/howto/connect-zeppelin">Connect Warp&nbsp;10 to Apache Zeppelin</a>


      <a class="list-group-item" href="/howto/monitoring-warp-10-using-warp-10">Monitoring Warp&nbsp;10</a>
    </div>

  </div>
</div>


    <div id="panel-tutorial" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-apis">
        <span class="glyphicon glyphicon-tasks"></span>APIs
      </a>
    </h4>
  </div>
  <div id="collapse-apis" class="panel-collapse collapse ">
    <div class="list-group">
      <a class="list-group-item" href="/docs/apis/">Overview</a>

      <a class="list-group-item" href="/docs/apis/warpscript">WarpScript</a>

      <a class="list-group-item" href="/docs/apis/fetch">Fetch</a>

      <a class="list-group-item" href="/docs/apis/ingress">Ingress</a>

      <a class="list-group-item" href="/docs/apis/delete">Delete</a>

      <a class="list-group-item" href="/docs/apis/gts-input-format">GTS input format</a>

      <a class="list-group-item" href="/docs/apis/gts-output-format">GTS output format</a>

    </div>

  </div>
</div>


    <div id="panel-reference" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-reference">
        <span class="glyphicon glyphicon-cog"></span>WarpScript</a>
    </h4>
  </div>
  <div id="collapse-reference" class="panel-collapse collapse ">
    <div class="list-group">
      <a class="list-group-item" href="/docs/reference/">Overview</a>

      <div class="list-group-item">
        <a href="/docs/reference/reference">Reference</a>
      </div>
      <div class="list-group" id="collapse-reference-list">
        <a class="list-group-item" href="/docs/reference/reference#frameworks">Frameworks</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-constant">Constant</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-math">Mathematical</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-standalone">Standalone</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-lists-maps">Lists &amp; maps</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-logic">Logic</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-stack">Stack</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-platform">Platform</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-gts">Geo Time Series<sup>®</sup></a>
        <a class="list-group-item" href="/docs/reference/reference#functions-bucketized-gts">Bucketized GTS</a>
        <a class="list-group-item" href="/docs/reference/reference#functions-geo">Geo-related</a>
      </div>
      <a class="list-group-item" href="/docs/reference/miscellaneous">Miscellaneous functions</a>
      <a class="list-group-item" href="/docs/reference/processing">Working with Processing</a>
    </div>
  </div>
</div>


    <div id="panel-tools" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#side-menu" href="#collapse-tools">
        <span class="glyphicon glyphicon-wrench"></span>Tools</a>
    </h4>
  </div>
  <div id="collapse-tools" class="panel-collapse collapse ">
    <div class="list-group">
      <div class="list-group-item">
        <a href="/tools/github_repositories">Github repositories</a>
      </div>
      <div class="list-group" id="collapse-git-list">
        <a class="list-group-item" href="/tools/github_repositories#Platform">Platform</a>
        <a class="list-group-item" href="/tools/github_repositories#Batch">Batch</a>
        <a class="list-group-item" href="/tools/github_repositories#Stream">Stream</a>
        <a class="list-group-item" href="/tools/github_repositories#Inputs">Input plugins</a>
        <a class="list-group-item" href="/tools/github_repositories#Outputs">Output plugins</a>
        <a class="list-group-item" href="/tools/github_repositories#Interpreters">Interpreters</a>
        <a class="list-group-item" href="/tools/github_repositories#IoT">IoT</a>
        <a class="list-group-item" href="/tools/github_repositories#UDFs">WarpScript UDFs</a>
        <a class="list-group-item" href="/tools/github_repositories#Extensions">WarpScript extensions</a>
        <a class="list-group-item" href="/tools/github_repositories#Websites">Websites</a>
        <a class="list-group-item" href="/tools/github_repositories#External">External contributions</a>
      </div>
      <a class="list-group-item" href="/docs/tools/worf">Worf</a>
      <a class="list-group-item" href="/docs/tools/quantum">Quantum</a>
      <a class="list-group-item" href="/docs/tools/trl">Token Revocation List</a>

    </div>

  </div>
</div>


    <div id="panel-support" class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a href="/docs/introduction/support/">
        <span class="glyphicon glyphicon-ok-circle"></span>Support
      </a>
    </h4>
  </div>
</div>



  </div>

</div>

      <div class="col-sm-9">
        <h1>Create a WarpScript extension</h1>
        <p>The aim of this tutorial is to show the user how to developp a WarpScript extension. WarpScript extensions are Java classes which modify the set of functions known to WarpScript. Using a WarpScript extension you can redefine, define new or remove existing functions. This tutorial will define the same function seen in the <a href="http://www.warp10.io/howto/create-a-udf/">create a UDF</a> tutorial.</p>

<p>In this page, we will learn how to implement a WarpScript set of functions and how to deploy it in your own platform. In this tutorial the set contains a single function which generates a single string from 2 strings that are currently on top of the WarpScript stack.</p>

<p>The full code is available on github <a href="https://github.com/cityzendata/warp10-ext-template">here</a>.</p>

<h2 id="functions-and-extension-interfaces">Functions and extension interfaces</h2>

<p>The Java functions exposed by a WarpScript extension must extend <a href="https://github.com/cityzendata/warp10-platform/blob/master/warp10/src/main/java/io/warp10/script/NamedWarpScriptFunction.java">NamedWarpScriptFunction</a> and implement the <a href="https://github.com/cityzendata/warp10-platform/blob/master/warp10/src/main/java/io/warp10/script/WarpScriptStackFunction.java">WarpScriptStackFunction</a> interface. The WarpScript extension itself extends <a href="https://github.com/cityzendata/warp10-platform/blob/8e83f966c939e4b58b9eb11cd86c396394a8e7f7/warp10/src/main/java/io/warp10/warp/sdk/WarpScriptExtension.java">WarpScriptExtension</a>. A WarpScript extension class must have a public parameter less constructor so the extension can be registered.</p>

<p>If a function pushes onto the stack a custom Java object, the given object must implement the <a href="https://github.com/cityzendata/warp10-platform/blob/master/warp10/src/main/java/io/warp10/script/functions/SNAPSHOT.java">Snapshotable</a> interface so if such an object appears in a macro or on the stack the stack or macro can still be snapshotted.</p>

<h2 id="getting-started">Getting started</h2>

<p>First of all, create a new Gradle project in your favorite IDE and add a new package in src/main/java: io.warp10.tutorial.</p>

<p>Then create the class HELLOWARP10 that extends <code>NamedWarpScriptFunction</code> and implements <code>WarpScriptStackFunction</code>.</p>

<p>Create also a class called TutorialExtension that extends <code>WarpScriptExtension</code>.</p>

<p>Use the same build.gradle than for an UDF, available <a href="/docs/assets/data/build.gradle">here</a>. Just change it’s title in manifest of the shadowJar task.</p>

<h2 id="develop-a-warpscript-function--hellowarp10">Develop a WarpScript function – HELLOWARP10</h2>

<p>Inside the class HELLOWARP10, add a contructor to set the name of the function. This name will be used to call this function in a WarpScript script.</p>

<pre><code>public HELLOWARP10(String name) {
    super(name);
}
</code></pre>

<p>Then implement the necessary function apply. This function as the same functionnality of the one defined in the UDF tutorial, except that the stack is directly given to the function.</p>

<pre><code>public Object apply(WarpScriptStack stack) throws WarpScriptException {
  
  //
  // Get params
  //
  
  Object firstText = stack.pop();
  Object secondText = stack.pop();
  
  if (!(firstText instanceof String)) {
    throw new WarpScriptException("First param must be a String");
  }
  if (!(secondText instanceof String)) {
    throw new WarpScriptException("Second param must be a String");
  }
  try {
    stack.push(firstText.toString() + ' ' + secondText.toString());
  } catch (WarpScriptException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
    throw new WarpScriptException("Stack exception" + e.getMessage() + e.getStackTrace().toString());
  }
  
  return stack;  
}
</code></pre>

<h2 id="the-extension-class--tutorialextension">The extension class – TutorialExtension</h2>

<p>In the class TutorialExtension, only the method getFunctions needs to be overwritten. In this method the user just has to declare the set of functions to add when using this defined extension. The functions have to be declared inside a Map, the map key is the function name, and the value an instance of the actual function class. If you wish to remove a function from WarpScript, use <code>null</code> as the value associated with the function name.</p>

<pre><code>private final Map&lt;String,Object&gt; functions;

public TutorialExtension() {
  this.functions = new HashMap&lt;String, Object&gt;();
  functions.put("HELLOWARP10", new HELLOWARP10("HELLOWARP10"));
}

public Map&lt;String, Object&gt; getFunctions() {
  return functions;
}
</code></pre>

<h2 id="add-this-extension-in-a-warp10-platform">Add this extension in a Warp10 platform</h2>

<p>Build this project executing the following command.</p>

<pre><code>gradle shadowJar
</code></pre>

<p>Then add the <code>warpscript.extensions properties</code> in your platform configuration file.</p>

<pre><code>//
// Comma separated list of WarpScriptExtension classes to instantiate to modify the defined WarpScript functions
//
warpscript.extensions = io.warp10.tutorial.TutorialExtension
</code></pre>

<p>Finally add the compiled jar in the classpath used to launch the Warp10 platform.</p>

<p>Restart the platform.</p>

<h2 id="use-the-function-defined-in-the-extension">Use the function defined in the extension</h2>

<p>To execute it, simply run the following WarpScript on your Warp 10 backend.</p>

<pre><code>'WARP 10' 'HELLO' HELLOWARP10
</code></pre>

<p>Congratulations, you managed to create your first WarpScript extension for Warp 10!</p>

      </div>
    </div>
  </div>
  

<!-- Footer -->
<footer>

  <hr>

  <div id="contact" class="container text-center">
    <!-- Footer -->
    <a class="webicons" href="https://twitter.com/CityzenData" target="_blank">
      <footer>
        <div id="contact" class="container text-center">
      <div class="webicon twitter"></div>
      <div class="webicon_text twitter">@CityzenData</div>
    </a>
    <a class="webicons" href="mailto:contact@cityzendata.com" target="_blank">
      <div class="webicon mail"></div>
      <div class="webicon_text mail">contact@cityzendata.com</div>
    </a>
  </div>

  <div class="container text-center top-margin">
    Copyright &copy; 2016 Cityzen Data
  </div>
  <div class="container text-center">
    <a href="/docs/introduction/legal">Legal</a>
  </div>

</footer>

<script>
    var template = document.querySelector('template[is="dom-bind"]');
</script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: 'e3f0d4e7cfac4e1065a92f60b3ec28d1',
indexName: 'warp10',
inputSelector: '#search_box'
});
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43780642-5', 'auto');
  ga('send', 'pageview');

</script>

<!-- Start of Async Drift Code -->
<script>
!function() {
  var t;
  if (t = window.driftt = window.drift = window.driftt || [], !t.init) return t.invoked ? void (window.console && console.error && console.error("Drift snippet included twice.")) : (t.invoked = !0, 
  t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
  t.factory = function(e) {
    return function() {
      var n;
      return n = Array.prototype.slice.call(arguments), n.unshift(e), t.push(n), t;
    };
  }, t.methods.forEach(function(e) {
    t[e] = t.factory(e);
  }), t.load = function(t) {
    var e, n, o, i;
    e = 3e5, i = Math.ceil(new Date() / e) * e, o = document.createElement("script"), 
    o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + i + "/" + t + ".js", 
    n = document.getElementsByTagName("script")[0], n.parentNode.insertBefore(o, n);
  });
}();
drift.SNIPPET_VERSION = '0.3.1';
drift.load('pf9x6nb43t24');
</script>
<!-- End of Async Drift Code -->
</body>
</html>
